<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>アイテム一覧</title>
    <style>
      body {
        font-family: "Helvetica Neue", Arial, sans-serif;
        margin: 40px;
        background: #f9f9f9;
        color: #333;
      }
      h1 {
        margin-bottom: 8px;
      }
      form {
        display: flex;
        gap: 8px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        background: #fff;
        box-shadow: 0 0 12px rgba(0, 0, 0, 0.05);
      }
      th,
      td {
        border: 1px solid #e0e0e0;
        padding: 12px;
        text-align: left;
      }
      th {
        background: #f3f3f3;
      }
      tr:nth-child(even) {
        background: #fbfbfb;
      }
      #status {
        margin-top: 12px;
        color: #666;
      }
    </style>
  </head>
  <body>
    <h1>アイテム一覧</h1>
    <form id="searchForm">
      <label>
        名称で検索：
        <input type="text" name="name" id="nameInput" placeholder="例：ノートパソコン" />
      </label>
      <button type="submit">検索</button>
      <button type="button" id="viewAll">全件表示</button>
    </form>
    <div id="status">ロード中…</div>
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>名称</th>
          <th>価格</th>
          <th>説明</th>
        </tr>
      </thead>
      <tbody id="itemsBody"></tbody>
    </table>
    <script>
      const status = document.getElementById("status");
      const itemsBody = document.getElementById("itemsBody");
      const form = document.getElementById("searchForm");
      const viewAllButton = document.getElementById("viewAll");

      const renderItems = (items) => {
        itemsBody.innerHTML = items
          .map(
            (item) => `
            <tr>
              <td>${item.id}</td>
              <td>${item.name}</td>
              <td>${item.price.toLocaleString()} 円</td>
              <td>${item.description ?? ""}</td>
            </tr>
          `
          )
          .join("");
        status.textContent = `${items.length} 件表示`;
      };

      const handleError = (message) => {
        status.textContent = message;
        itemsBody.innerHTML = "";
      };

      const fetchItems = async (path) => {
        try {
          status.textContent = "読み込み中…";
          const res = await fetch(path);
          if (!res.ok) {
            throw new Error("ステータス " + res.status);
          }
          const items = await res.json();
          renderItems(items);
        } catch (error) {
          handleError("取得失敗: " + error.message);
        }
      };

      form.addEventListener("submit", (event) => {
        event.preventDefault();
        const name = document.getElementById("nameInput").value.trim();
        if (!name) {
          handleError("名前を入力してください");
          return;
        }
        fetchItems(`/api/items/search?name=${encodeURIComponent(name)}`);
      });

      viewAllButton.addEventListener("click", () => {
        fetchItems("/api/items/all");
      });

      // 初期表示
      fetchItems("/api/items/all");
    </script>
  </body>
</html>
